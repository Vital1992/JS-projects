<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Asynchronous JavaScript</title>
</head>
<body>
    <h1>Asynchronous JavaScript</h1>
    <script>
    /*
    const second = () => {
      setTimeout(() => {
        console.log('Async') //Will appear after 2 sec
      }, 2000)

      /*------------
      //OR
      setTimeout(
        function(){
          console.log('Async')
        }, 2000
      )------------*/
/*
    }
    const first = () => {
      console.log('Hi first');
      second();
      console.log("The end")
    }
    first();
*/

//Async callbacks---------------------------------------------------------------
/*
function getRecipe(){
  setTimeout(() => {
    const recipeID = [342, 234, 464, 654];
    console.log(recipeID); //Will pop up first after 1,5 sec

    setTimeout(id => {
      const recipe = {title: 'Tomato pasta', publisher: 'John'};
      console.log(`${id}: ${recipe.title}`); //Will pop up second, after console.log(recipeID), because it's inside first setTimeout

      setTimeout(publisher => {
        const recipe2 = {title: 'Pizza', publisher: 'Jack'};
        console.log(recipe);
      }, 1500, recipe.publisher); //recipe.publisher is the value of publisher arg

    }, 1000, recipeID[2]); //recipeID[2] is the value for the id argument

  }, 1500)
}
getRecipe();
*/

//Promises----------------------------------------------------------------------
// Object that keeps track about whether a certain event has happened or not
//Determines what happens after the event has happened
//Implements the concept of a future value that we're expecting
/*
const getIDs = new Promise((resolve, reject)=>{
  setTimeout(() => {
    resolve([342, 234, 464, 654]);
  }, 1500);
});

const getRecipe = recipeID => {
  return new Promise((resolve, reject) => {
    setTimeout(id => {
      const recipe = {title: 'Tomato pasta', publisher: 'John'};
      resolve(`${id}: ${recipe.title}`);
    }, 1500, recipeID);
  });
};

const getRelated = publisher => {
  return new Promise((resolve, reject) => {
    setTimeout(pub => {
      const recipe = {title: 'Pizza', publisher: 'Jack'};
      resolve(`${pub}: ${recipe.title}`);
    },1500, publisher)
  })
};

getIDs
.then(IDs => { //IDs is the result if promise getIDs, whatever is in resolve(), in this example it's array
console.log(IDs);
return getRecipe(IDs[2])
})
.then(recipe => { //recipe is the result of getRecipe(IDs[2]), which is 464
  console.log(recipe);
  return getRelated('John');
})
.then(recipe=> {
  console.log(recipe);
})
.catch(error => {
  console.log('Error'); //error will be result of reject()
});

//Result:
//[342, 234, 464, 654]
//464: Tomato pasta
//John: Pizza
*/

//Async Await-------------------------------------------------------------------
//Create promises in the same way as before
const getIDs = new Promise((resolve, reject)=>{
  setTimeout(() => {
    resolve([342, 234, 464, 654]);
  }, 1500);
});

const getRecipe = recipeID => {
  return new Promise((resolve, reject) => {
    setTimeout(id => {
      const recipe = {title: 'Tomato pasta', publisher: 'John'};
      resolve(`${id}: ${recipe.title}`);
    }, 1500, recipeID);
  });
};

const getRelated = publisher => {
  return new Promise((resolve, reject) => {
    setTimeout(pub => {
      const recipe = {title: 'Pizza', publisher: 'Jack'};
      resolve(`${pub}: ${recipe.title}`);
    },1500, publisher)
  })
};
//------
async function getRecipesAW(){
  const IDs = await getIDs;
  console.log(IDs);
  const recipe = await getRecipe(IDs[2]);
  console.log(recipe);
  const related = await getRelated('John');
  console.log(related);

  return recipe;
}
/*
//If we want to return promise and console log it, this won't work
const rec = getRecipesAW();
console.log(rec); //result: PromiseÂ {<pending>} because getRecipesAW still running asynchronously and result of promise is not ready yet
*/
//We should do that this way:
getRecipesAW()
.then(recipe => {
  console.log(recipe) //result: [342, 234, 464, 654]
//464: Tomato pasta
//John: Pizza
//464: Tomato pasta
})
    </script>
</body>
</html>
